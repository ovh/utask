<tag-input [(ngModel)]='filter.tags' [modelAsStrings]="true" #input (onRemove)="filterSteps()" (onAdd)="filterSteps()">
    <tag-input-dropdown [showDropdownIfEmpty]="true" [autocompleteItems]="presentStates">
    </tag-input-dropdown>
    <ng-template let-item="item" let-index="index">
        <span *ngIf="item.startsWith('State:')">
            <span class="fas {{getIcon(item.split(':')[1])}}"></span> {{ item.split(':')[1] }}
        </span>
        <span *ngIf="!item.startsWith('State:')">
            {{ item }}
        </span>
        <delete-icon (click)="input.onRemoveRequested(item, index)"></delete-icon>
    </ng-template>
</tag-input>

<ng-container *ngFor="let stepName of filteredStepNames">
    <lib-utask-box
        [header]="{openable: true, init: true, class: 'primary', openOnClick: true, color: (states[resolution.steps[stepName].state] ? states[resolution.steps[stepName].state].color : defaultState.color), fontColor: (states[resolution.steps[stepName].state] ? states[resolution.steps[stepName].state].fontColor : defaultState.fontColor)}">
        <div app-box-header>{{resolution.steps[stepName].state}} - {{stepName}}</div>
        <div app-box-content>
            <div *ngIf="resolution.steps[stepName].output">
                Output:
                <lib-utask-editor [ngModel]="JSON.stringify(resolution.steps[stepName].output, null, 4)"
                    ngDefaultControl [ngModelOptions]="{standalone: true}" [config]="editorConfigPayload">
                </lib-utask-editor>
            </div>

            <div *ngIf="resolution.steps[stepName].children">
                Children:
                <lib-utask-editor [ngModel]="JSON.stringify(resolution.steps[stepName].children, null, 4)"
                    ngDefaultControl [ngModelOptions]="{standalone: true}" [config]="editorConfigChildren">
                </lib-utask-editor>
            </div>

            <div *ngIf="resolution.steps[stepName].error">
                <span *ngIf="resolution.steps[stepName].state !== 'DONE'">Error:</span>
                <span *ngIf="resolution.steps[stepName].state === 'DONE'">Message:</span>
                <lib-utask-editor [ngModel]="JSON.stringify(resolution.steps[stepName].error, null, 4)" ngDefaultControl
                    [ngModelOptions]="{standalone: true}" [config]="editorConfigError"></lib-utask-editor>
            </div>

            <small
                *ngIf="resolution.steps[stepName].last_run && resolution.steps[stepName].last_run != '0001-01-01T00:00:00Z'">
                Last run: <strong>{{resolution.steps[stepName].last_run | utaskFromNow}}</strong>
            </small>
            <button type="button" class="btn btn-secondary btn-outline-primary"
                (click)="previewStepDetails(resolution.steps[stepName])">View</button>
        </div>
    </lib-utask-box>
</ng-container>