<form nz-form [formGroup]="validateForm" (ngSubmit)="submitForm()">
  <nz-form-item>
    <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired nzFor="template">Template</nz-form-label>
    <nz-form-control class="template-input" [nzSm]="14" [nzXs]="24" nzErrorTip="Please select a template!"
      [nzExtra]="templateInfo">
      <nz-select formControlName="template" id="template" (ngModelChange)="templateChange($event)">
        <ng-template ngFor let-template [ngForOf]="templates">
          <nz-option [nzDisabled]="template.blocked" [nzValue]="template" [nzLabel]="template.description">
          </nz-option>
        </ng-template>
      </nz-select>
      <ng-template #templateInfo>
        <ng-container *ngIf="selectedTemplate">
          <nz-alert *ngIf="selectedTemplate.long_description ||Â selectedTemplate.doc_link" nzType="info"
            [nzMessage]="templateInfoMessage" nzShowIcon></nz-alert>
          <ng-template #templateInfoMessage>
            <p *ngIf="selectedTemplate.long_description" style="white-space: pre-line;">
              {{selectedTemplate.long_description}}
              <ng-container *ngIf="selectedTemplate.doc_link">
                <br /><a href="{{selectedTemplate.doc_link}}" target="_blank">{{selectedTemplate.doc_link}}</a>
              </ng-container>
            </p>
          </ng-template>
        </ng-container>
      </ng-template>
    </nz-form-control>
  </nz-form-item>

  <ng-container *ngIf="selectedTemplate">
    <nz-form-item *ngFor="let input of selectedTemplate.inputs">
      <nz-form-label *ngIf="input.regex" [nzSm]="6" [nzXs]="24" nzFor="input_{{input.name}}"
        [nzRequired]="!input.optional" [nzTooltipTitle]="input.regex" nzTooltipIcon="info-circle">
        {{input.name}}
      </nz-form-label>
      <nz-form-label *ngIf="!input.regex" [nzSm]="6" [nzXs]="24" nzFor="input_{{input.name}}"
        [nzRequired]="!input.optional">
        {{input.name}}
      </nz-form-label>
      <nz-form-control [nzExtra]="input.description" [nzSm]="14" [nzXs]="24"
        nzErrorTip="Please set a valid value for {{input.name}}!">
        <!-- Input text(regex), number, password -->
        <ng-container *ngIf="!input.legal_values && input.type!='bool' && !input.collection">
          <input type="number" formControlName="input_{{input.name}}" nz-input *ngIf="input.type=='number'"
            placeholder="{{input.default}}">
          <input type="password" formControlName="input_{{input.name}}" nz-input *ngIf="input.type=='password'">
          <input type="text" formControlName="input_{{input.name}}" nz-input
            *ngIf="input.type!='number' && input.type!='password'" [pattern]="input.regex">
        </ng-container>
        <!-- Input multiple with strict values -->
        <nz-select formControlName="input_{{input.name}}" *ngIf="input.legal_values && input.collection"
          nzMode="multiple" nzPlaceHolder="Please select">
          <nz-option *ngFor="let item of input.legal_values" [nzLabel]="item" [nzValue]="item"></nz-option>
        </nz-select>
        <!-- Input multiple with free values -->
        <nz-select formControlName="input_{{input.name}}" *ngIf="!input.legal_values && input.collection" nzMode="tags"
          nzPlaceHolder="Please add a value">
        </nz-select>
        <!-- Input simple with strict values -->
        <nz-select formControlName="input_{{input.name}}" *ngIf="input.legal_values && !input.collection"
          nzPlaceHolder="Please select">
          <nz-option *ngFor="let item of input.legal_values" [nzLabel]="item" [nzValue]="item"></nz-option>
        </nz-select>
        <!-- Input boolean -->
        <label formControlName="input_{{input.name}}" *ngIf="input.type=='bool'" nz-checkbox></label>
      </nz-form-control>
    </nz-form-item>
  </ng-container>

  <nz-form-item>
    <nz-form-label [nzSm]="6" [nzXs]="24" nzFor="watchers">
      Watchers
    </nz-form-label>
    <nz-form-control [nzSm]="14" [nzXs]="24" nzErrorTip="Please set a valid value for watchers!">
      <nz-select formControlName="watchers" nzMode="tags" nzPlaceHolder="Usernames">
      </nz-select>
    </nz-form-control>
  </nz-form-item>

  <nz-form-item nz-row class="register-area">
    <nz-form-control [nzSpan]="14" [nzOffset]="6">
      <button nz-button nzType="primary">Submit</button>
    </nz-form-control>
  </nz-form-item>
</form>

<lib-utask-error-message [data]="errors.submit" *ngIf="errors.submit"></lib-utask-error-message>
<utask-loader *ngIf="loaders.templates"></utask-loader>
<lib-utask-error-message [data]="errors.templates" *ngIf="errors.templates"></lib-utask-error-message>